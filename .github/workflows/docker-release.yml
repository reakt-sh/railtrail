name: Release Docker Images

on:
    release:
        types: [published]
    workflow_dispatch: # manual triggering, for debugging purposes

permissions:
    contents: read
    packages: write
    # This is used to complete the identity challenge
    # with sigstore/fulcio when running outside of PRs.
    id-token: write

jobs:
    release-positioning-backend:
        name: Release Positioning Server
        uses: ./.github/workflows/do-deploy-docker.yml
        with:
            name: ${{ github.repository }}-server-positioning
            file: Dockerfile.positioning
            registry: ghcr.io

    release-website-backend:
        name: Release Website Server
        uses: ./.github/workflows/do-deploy-docker.yml
        with:
            name: ${{ github.repository }}-server-website
            file: Dockerfile.website
            registry: ghcr.io

    release-db-migration:
        name: Release DB Migration Service
        uses: ./.github/workflows/do-deploy-docker.yml
        with:
            name: ${{ github.repository }}-server-db-migration
            file: Dockerfile.migration
            registry: ghcr.io
